/ Bootstrap CSS Toolkit styles
%link{:href => "http://blueimp.github.com/cdn/css/bootstrap.min.css", :rel => "stylesheet"}/
/ Bootstrap styles for responsive website layout, supporting different screen sizes
%link{:href => "http://blueimp.github.com/cdn/css/bootstrap-responsive.min.css", :rel => "stylesheet"}/
/ Bootstrap CSS fixes for IE6
/[if lt IE 7] <link rel="stylesheet" href="http://blueimp.github.com/cdn/css/bootstrap-ie6.min.css">
/ Bootstrap Image Gallery styles
/
  <link rel="stylesheet" href="http://blueimp.github.com/Bootstrap-Image-Gallery/css/bootstrap-image-gallery.min.css">
  \->
  <!- CSS to style the file input field as button and adjust the Bootstrap progress bars
:css
  .container {
  	width:100%;
  }
%br/
/
  The file upload form used as target for the file upload widget
  
  <form id="fileupload" action="/uploads" method="POST" enctype="multipart/form-data">
= form_for Upload.new, :html => { :multipart => true, :id => "fileupload"} do |f|
  = f.hidden_field :house_id, :value => @tour.id
  %br/
  / Redirect browsers with JavaScript disabled to the origin page
  %noscript
    %input{:name => "redirect", :type => "hidden", :value => "http://blueimp.github.com/jQuery-File-Upload/"}/
  / The fileupload-buttonbar contains buttons to add/delete files and start/cancel the upload
  .row.fileupload-buttonbar
    .span7
      / The fileinput-button span is used to style the file input field as button
      %span.btn.btn-success.fileinput-button
        %i.icon-plus.icon-white
        %span Add files...
        /
          <input type="file" name="files[]" multiple>
        = f.file_field :upload, :multiple => true, :name => "upload[upload]"
      %button.btn.btn-primary.start{:type => "submit"}
        %i.icon-upload.icon-white
        %span Start upload
      %button.btn.btn-warning.cancel{:type => "reset"}
        %i.icon-ban-circle.icon-white
        %span Cancel upload
      %button.btn.btn-danger.delete{:type => "button"}
        %i.icon-trash.icon-white
        %span Delete
      %input.toggle{:type => "checkbox"}/
    / The global progress information
    .span5.fileupload-progress.fade
      / The global progress bar
      .progress.progress-success.progress-striped.active{"aria-valuemax" => "100", "aria-valuemin" => "0", :role => "progressbar"}
        .bar{:style => "width:0%;"}
      / The extended global progress information
      .progress-extended &nbsp;
  / The loading indicator is shown during file processing
  .fileupload-loading
  %br/
  / The table listing the files available for upload/download
  %table.table.table-striped{:role => "presentation"}
    %tbody.files{"data-target" => "#modal-gallery", "data-toggle" => "modal-gallery"}
%br/
.well
  %h3 Demo Notes
  %ul
    %li
      The maximum file size for uploads in this demo is
      %strong 5 MB
      (default file size is unlimited).
    %li
      Only image files (
      %strong> JPG, GIF, PNG
      ) are allowed in this demo (by default there is no file type restriction).
    %li
      Uploaded files will be deleted automatically after
      %strong 5 minutes
      (demo setting).
    %li
      You can
      %strong drag &amp; drop
      files from your desktop on this webpage with Google Chrome, Mozilla Firefox and Apple Safari.
    %li
      Please refer to the
      %a{:href => "https://github.com/blueimp/jQuery-File-Upload"} project website
      and
      %a{:href => "https://github.com/blueimp/jQuery-File-Upload/wiki"} documentation
      for more information.
    %li
      Built with Twitter's
      %a{:href => "http://twitter.github.com/bootstrap/"} Bootstrap
      toolkit and Icons from
      = succeed "." do
        %a{:href => "http://glyphicons.com/"} Glyphicons
/ modal-gallery is the modal dialog used for the image gallery
#modal-gallery.modal.modal-gallery.hide.fade{"data-filter" => ":odd", :tabindex => "-1"}
  .modal-header
    %a.close{"data-dismiss" => "modal"} &times;
    %h3.modal-title
  .modal-body
    .modal-image
  .modal-footer
    %a.btn.modal-download{:target => "_blank"}
      %i.icon-download
      %span Download
    %a.btn.btn-success.modal-play.modal-slideshow{"data-slideshow" => "5000"}
      %i.icon-play.icon-white
      %span Slideshow
    %a.btn.btn-info.modal-prev
      %i.icon-arrow-left.icon-white
      %span Previous
    %a.btn.btn-primary.modal-next
      %span Next
      %i.icon-arrow-right.icon-white
/ The template to display files available for upload
%script#template-upload{:type => "text/x-tmpl"}
  {% for (var i=0, file; file=o.files[i]; i++) { %}
  <tr class="template-upload fade">
  <td class="preview"><span class="fade"></span></td>
  <td class="name"><span>{%=file.name%}</span></td>
  <td class="size"><span>{%=o.formatFileSize(file.size)%}</span></td>
  {% if (file.error) { %}
  <td class="error" colspan="2"><span class="label label-important">Error</span> {%=file.error%}</td>
  {% } else if (o.files.valid && !i) { %}
  <td>
  <div class="progress progress-success progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"><div class="bar" style="width:0%;"></div></div>
  </td>
  <td class="start">{% if (!o.options.autoUpload) { %}
  <button class="btn btn-primary">
  <i class="icon-upload icon-white"></i>
  <span>Start</span>
  </button>
  {% } %}</td>
  {% } else { %}
  <td colspan="2"></td>
  {% } %}
  <td class="cancel">{% if (!i) { %}
  <button class="btn btn-warning">
  <i class="icon-ban-circle icon-white"></i>
  <span>Cancel</span>
  </button>
  {% } %}</td>
  </tr>
  {% } %}
/ The template to display files available for download
%script#template-download{:type => "text/x-tmpl"}
  {% for (var i=0, file; file=o.files[i]; i++) { %}
  <tr class="template-download fade">
  {% if (file.error) { %}
  <td></td>
  <td class="name"><span>{%=file.name%}</span></td>
  <td class="size"><span>{%=o.formatFileSize(file.size)%}</span></td>
  <td class="error" colspan="2"><span class="label label-important">Error</span> {%=file.error%}</td>
  {% } else { %}
  <td class="preview">{% if (file.thumbnail_url) { %}
  <a href="{%=file.url%}" title="{%=file.name%}" data-gallery="gallery" download="{%=file.name%}"><img src="{%=file.thumbnail_url%}"></a>
  {% } %}</td>
  <td class="name">
  <a href="{%=file.url%}" title="{%=file.name%}" data-gallery="{%=file.thumbnail_url&&'gallery'%}" download="{%=file.name%}">{%=file.name%}</a>
  </td>
  <td class="size"><span>{%=o.formatFileSize(file.size)%}</span></td>
  <td colspan="2"></td>
  {% } %}
  <td class="delete">
  <button class="btn btn-danger" data-type="{%=file.delete_type%}" data-url="{%=file.delete_url%}"{% if (file.delete_with_credentials) { %} data-xhr-fields='{"withCredentials":true}'{% } %}>
  <i class="icon-trash icon-white"></i>
  <span>Delete</span>
  </button>
  <input type="checkbox" name="delete" value="1">
  </td>
  </tr>
  {% } %}
/ The main application script
:javascript
  /*jslint nomen: true, unparam: true, regexp: true */
  /*global $, window, document */

  $(function () {
      'use strict';

      // Initialize the jQuery File Upload widget:
      $('#fileupload').fileupload({
          // Uncomment the following to send cross-domain cookies:
          //xhrFields: {withCredentials: true},
          url: '/uploads'
      });

      // Enable iframe cross-domain access via redirect option:
      $('#fileupload').fileupload(
          'option',
          'redirect',
          window.location.href.replace(
              /\/[^\/]*$/,
              '/cors/result.html?%s'
          )
      );

      if (true) {
          // Demo settings:
          $('#fileupload').fileupload('option', {
              url: '/uploads',
              maxFileSize: 5000000,
              acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
              process: [
                  {
                      action: 'load',
                      fileTypes: /^image\/(gif|jpeg|png)$/,
                      maxFileSize: 20000000 // 20MB
                  },
                  {
                      action: 'resize',
                      maxWidth: 1440,
                      maxHeight: 900
                  },
                  {
                      action: 'save'
                  }
              ]
          });
  
          // Upload server status check for browsers with CORS support:
          /*
  		if ($.support.cors) {
              $.ajax({
                  url: '/uploads',
                  type: 'HEAD'
              }).fail(function () {
                  $('<span class="alert alert-error"/>')
                      .text('Upload server currently unavailable - ' +
                              new Date())
                      .appendTo('#fileupload');
              });
          }
      } else {
          // Load existing files:
          $.ajax({
              // Uncomment the following to send cross-domain cookies:
              //xhrFields: {withCredentials: true},
              url: $('#fileupload').fileupload('option', 'url'),
              dataType: 'json',
              context: $('#fileupload')[0]
          }).done(function (result) {
              $(this).fileupload('option', 'done')
                  .call(this, null, {result: result});
          });*/
      }

  });
